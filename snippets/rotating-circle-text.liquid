{% comment %}
  Rotating Circle Text Component

  Usage:
  {% render 'rotating-circle-text',
    id: 'unique-id',
    trigger_section_id: 'section-id-to-trigger-animation',
    main_text_line1: 'Main',
    main_text_line2: 'Text',
    circular_text: 'Circular Text Surrounding The Main Text • Cool SVG Design •',
    main_text_size: 30,
    main_text_color: '#1e293b',
    circular_text_size: 14,
    circular_text_color: '#4f46e5',
    size: 256
  %}

  Parameters:
  - id: (required) Unique ID for this instance
  - trigger_section_id: (required) ID of the section that triggers the animation
  - main_text_line1: First line of center text
  - main_text_line2: Second line of center text
  - circular_text: Text that rotates around the circle
  - main_text_size: Font size for center text (px)
  - main_text_color: Color for center text
  - circular_text_size: Font size for circular text (px)
  - circular_text_color: Color for circular text
  - size: Width/height of the component (px)
{% endcomment %}

{%- liquid
  assign component_id = id | default: 'rotating-circle'
  assign trigger_id = trigger_section_id | default: ''
  assign line1 = main_text_line1 | default: 'Main'
  assign line2 = main_text_line2 | default: 'Text'
  assign circular = circular_text | default: 'Circular Text Surrounding The Main Text • Cool SVG Design •'
  assign main_size = main_text_size | default: 30
  assign main_color = main_text_color | default: '#1e293b'
  assign circ_size = circular_text_size | default: 14
  assign circ_color = circular_text_color | default: '#4f46e5'
  assign component_size = size | default: 256
-%}

<style>
  #{{ component_id }} {
    width: {{ component_size }}px;
    height: {{ component_size }}px;
  }

  #{{ component_id }} .main-text {
    fill: {{ main_color }};
    font-size: {{ main_size }}px;
  }

  #{{ component_id }} .circular-text {
    fill: {{ circ_color }};
    font-size: {{ circ_size }}px;
  }
</style>

<div id="{{ component_id }}" class="rotating-circle-component">
  <svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
    <defs>
      <path id="circlePath-{{ component_id }}"
            d="M 200, 200 m -120, 0 a 120, 120 0 1, 1 240, 0 a 120, 120 0 1, 1 -240, 0" />
    </defs>

    <text x="200" y="200"
          text-anchor="middle"
          class="main-text font-sans font-bold uppercase tracking-tighter">
      <tspan x="200" dy="-0.2em">{{ line1 }}</tspan>
      <tspan x="200" dy="1.2em">{{ line2 }}</tspan>
    </text>

    <g class="rotating-text-group">
      <text class="circular-text font-sans tracking-[0.2em] uppercase font-medium">
        <textPath href="#circlePath-{{ component_id }}" startOffset="0%">
          {{ circular }}
        </textPath>
      </text>
    </g>
  </svg>
</div>

{%- if trigger_id != blank -%}
  <script>
    (function () {
      const componentId = '{{ component_id }}';
      const triggerId = '{{ trigger_id }}';

      function initRotatingText() {
        const component = document.getElementById(componentId);
        const trigger = document.getElementById(triggerId);

        if (!component || !trigger) return;

        const rotatingGroup = component.querySelector('.rotating-text-group');
        if (!rotatingGroup) return;

        gsap.to(rotatingGroup, {
          rotation: 360,
          transformOrigin: 'center center',
          ease: 'none',
          scrollTrigger: {
            trigger: trigger,
            start: 'top bottom',
            end: 'bottom top',
            scrub: 1,
          },
        });
      }

      // Run when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initRotatingText);
      } else {
        // Small delay to ensure GSAP and ScrollTrigger are loaded
        setTimeout(initRotatingText, 50);
      }
    })();
  </script>
{%- endif -%}
