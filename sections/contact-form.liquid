{% comment %}
  Section: Custom Contact Form
  Dependencies: Tailwind CSS (or similar utility classes)
{% endcomment %}

<div class="contact-form-section py-12 px-4 max-w-4xl mx-auto">
  {% if section.settings.title != blank %}
    <h2 class="text-3xl font-bold text-center mb-8">{{ section.settings.title }}</h2>
  {% endif %}

  {% form 'contact', class: 'w-full' %}
    {% comment %} Success / Error Messages {% endcomment %}
    {% if form.posted_successfully? %}
      <div class="p-4 mb-6 bg-green-100 text-green-700 rounded border border-green-200">
        {{ 'templates.contact.form.post_success' | t }}
      </div>
    {% elsif form.errors %}
      <div class="p-4 mb-6 bg-red-100 text-red-700 rounded border border-red-200">
        {{ form.errors | default_errors }}
      </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% comment %}
        REQUIRED BLOCKS: Name and Email
        These are hardcoded to ensure functionality but styled to match the grid.
      {% endcomment %}

      <div class="col-span-1">
        <label for="ContactForm-name" class="block text-sm font-medium text-gray-700 mb-1"
          >Name <span class="text-red-500">*</span></label
        >
        <input
          type="text"
          name="contact[name]"
          id="ContactForm-name"
          value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
          class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
          required
        >
      </div>

      <div class="col-span-1">
        <label for="ContactForm-email" class="block text-sm font-medium text-gray-700 mb-1"
          >Email <span class="text-red-500">*</span></label
        >
        <input
          type="email"
          name="contact[email]"
          id="ContactForm-email"
          value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
          class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
          required
        >
      </div>

      {% comment %} DYNAMIC BLOCKS {% endcomment %}
      {% for block in section.blocks %}
        {%- assign half_width = block.settings.half_width -%}
        {%- assign is_required = block.settings.is_required -%}
        {%- assign label_handle = block.settings.label | handleize -%}

        <div class="col-span-1 {% unless half_width %}md:col-span-2{% endunless %}" {{ block.shopify_attributes }}>
          {% case block.type %}
              {% comment %} --- PHONE BLOCK --- {% endcomment %}
            {% when 'phone' %}
              <label for="ContactForm-phone-{{ block.id }}" class="block text-sm font-medium text-gray-700 mb-1">
                {{ block.settings.label }}
                {% if is_required -%}
                  <span class="text-red-500">*</span>
                {%- endif %}
              </label>
              <input
                type="tel"
                name="contact[phone]"
                id="ContactForm-phone-{{ block.id }}"
                pattern="[0-9\-]*"
                class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
                {% if is_required %}
                  required
                {% endif %}
              >

              {% comment %} --- CUSTOM INPUT BLOCK --- {% endcomment %}
            {% when 'custom_input' %}
              <label
                for="ContactForm-{{ label_handle }}-{{ block.id }}"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                {{ block.settings.label }}
                {% if is_required -%}
                  <span class="text-red-500">*</span>
                {%- endif %}
              </label>

              {% if block.settings.input_type == 'multiline' %}
                <textarea
                  rows="4"
                  name="contact[{{ block.settings.label }}]"
                  id="ContactForm-{{ label_handle }}-{{ block.id }}"
                  class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
                  {% if is_required %}
                    required
                  {% endif -%}
                ></textarea>
              {% else %}
                <input
                  type="{{ block.settings.input_type }}"
                  name="contact[{{ block.settings.label }}]"
                  id="ContactForm-{{ label_handle }}-{{ block.id }}"
                  class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
                  {% if is_required %}
                    required
                  {% endif %}
                >
              {% endif %}

              {% comment %} --- DROPDOWN BLOCK --- {% endcomment %}
            {% when 'dropdown' %}
              <label
                for="ContactForm-{{ label_handle }}-{{ block.id }}"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                {{ block.settings.label }}
                {% if is_required -%}
                  <span class="text-red-500">*</span>
                {%- endif %}
              </label>
              <select
                name="contact[{{ block.settings.label }}]"
                id="ContactForm-{{ label_handle }}-{{ block.id }}"
                class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent bg-white"
                {% if is_required %}
                  required
                {% endif %}
              >
                {% assign options = block.settings.options | split: ',' %}
                <option value="" disabled selected>Select an option</option>
                {% for option in options %}
                  <option value="{{ option | strip }}">{{ option | strip }}</option>
                {% endfor %}
              </select>

              {% comment %} --- CHECKBOX BLOCK --- {% endcomment %}
            {% when 'checkbox' %}
              <div class="flex items-center mt-6">
                <input type="hidden" name="contact[{{ block.settings.label }}]" value="No">
                <input
                  type="checkbox"
                  name="contact[{{ block.settings.label }}]"
                  value="Yes"
                  id="ContactForm-{{ label_handle }}-{{ block.id }}"
                  class="h-4 w-4 text-black border-gray-300 rounded focus:ring-black"
                  {% if is_required %}
                    required
                  {% endif %}
                >
                <label for="ContactForm-{{ label_handle }}-{{ block.id }}" class="ml-2 block text-sm text-gray-700">
                  {{ block.settings.label }}
                  {% if is_required -%}
                    <span class="text-red-500">*</span>
                  {%- endif %}
                </label>
              </div>

              {% comment %} --- TEXT BLOCK (Static text) --- {% endcomment %}
            {% when 'text' %}
              <div class="rte text-gray-600 text-sm">
                {{ block.settings.content }}
              </div>
          {% endcase %}
        </div>
      {% endfor %}

      {% comment %} SUBMIT BUTTON {% endcomment %}
      <div class="col-span-1 md:col-span-2 mt-4">
        <button
          type="submit"
          class="w-full md:w-auto px-8 py-3 bg-black text-white font-bold uppercase tracking-widest text-sm hover:bg-gray-800 transition duration-300 rounded"
        >
          Send Message
        </button>
      </div>
    </div>
  {% endform %}
</div>

{% schema %}
{
  "name": "Custom Contact Form",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Form Title",
      "default": "Contact Us"
    }
  ],
  "blocks": [
    {
      "type": "phone",
      "name": "Phone Number",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Phone Number"
        },
        {
          "type": "checkbox",
          "id": "is_required",
          "label": "Required",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "half_width",
          "label": "Half width on large screens",
          "default": true
        }
      ]
    },
    {
      "type": "custom_input",
      "name": "Custom Input",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Subject"
        },
        {
          "type": "select",
          "id": "input_type",
          "label": "Input Type",
          "options": [
            { "value": "text", "label": "Single Line Text" },
            { "value": "multiline", "label": "Multiline Text" },
            { "value": "email", "label": "Email" },
            { "value": "tel", "label": "Phone" },
            { "value": "number", "label": "Number" },
            { "value": "url", "label": "URL" }
          ],
          "default": "text"
        },
        {
          "type": "checkbox",
          "id": "is_required",
          "label": "Required",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "half_width",
          "label": "Half width on large screens",
          "default": false
        }
      ]
    },
    {
      "type": "dropdown",
      "name": "Dropdown",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Reason for inquiry"
        },
        {
          "type": "textarea",
          "id": "options",
          "label": "Options (comma separated)",
          "default": "Order Status, Returns, General Question",
          "info": "Separate options with a comma"
        },
        {
          "type": "checkbox",
          "id": "is_required",
          "label": "Required",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "half_width",
          "label": "Half width on large screens",
          "default": true
        }
      ]
    },
    {
      "type": "checkbox",
      "name": "Checkbox",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "I agree to terms"
        },
        {
          "type": "checkbox",
          "id": "is_required",
          "label": "Required",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "half_width",
          "label": "Half width on large screens",
          "default": true
        }
      ]
    },
    {
      "type": "text",
      "name": "Text / Paragraph",
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add instructions or extra info here.</p>"
        },
        {
          "type": "checkbox",
          "id": "half_width",
          "label": "Half width on large screens",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Contact Form",
      "blocks": [
        {
          "type": "phone"
        },
        {
          "type": "custom_input",
          "settings": {
            "label": "Message",
            "input_type": "multiline"
          }
        }
      ]
    }
  ]
}
{% endschema %}
