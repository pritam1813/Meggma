{%- style -%}
  #parallax-section-{{ section.id }} {
    background-color: {{ section.settings.section_bg_color }};
  }

  #parallax-section-{{ section.id }} .heading-primary {
    font-size: {{ section.settings.heading_font_size }}px;
    color: {{ section.settings.heading_text_color }};
  }

  #parallax-section-{{ section.id }} .heading-secondary {
    font-size: {{ section.settings.subheading_font_size }}px;
    color: {{ section.settings.subheading_text_color }};
  }

  #parallax-section-{{ section.id }} .description-text {
    font-size: {{ section.settings.description_font_size }}px;
    color: {{ section.settings.description_text_color }};
  }

  #parallax-section-{{ section.id }} .btn-primary {
    background-color: {{ section.settings.primary_button_bg }};
    color: {{ section.settings.primary_button_text_color }};
  }

  #parallax-section-{{ section.id }} .btn-primary:hover {
    opacity: 0.9;
  }

  #parallax-section-{{ section.id }} .btn-secondary {
    background-color: {{ section.settings.secondary_button_bg }};
    color: {{ section.settings.secondary_button_text_color }};
    border-color: {{ section.settings.secondary_button_text_color }};
  }

  #parallax-section-{{ section.id }} .btn-secondary:hover {
    opacity: 0.9;
  }
{%- endstyle -%}

<section
  id="parallax-section-{{ section.id }}"
  data-section-id="{{ section.id }}"
  class="parallax-w-text relative flex flex-col items-center justify-center px-6 py-24 text-center overflow-hidden"
>
  <div class="relative w-full max-w-2xl flex flex-col items-center">
    <div class="textcontainer">
      <h2 class="heading-primary font-extrabold mb-2">
        {{ section.settings.heading_text }}
      </h2>
      <h2 class="heading-secondary font-extrabold mb-2">
        {{ section.settings.subheading_text }}
      </h2>
    </div>

    <div class="mainimg relative w-full max-w-md">
      {%- if section.settings.main_image != blank -%}
        <img
          src="{{ section.settings.main_image | image_url: width: 800 }}"
          alt="{{ section.settings.main_image.alt | default: section.settings.heading_text }}"
          class="rounded-2xl shadow-2xl w-full object-cover"
          width="{{ section.settings.main_image.width }}"
          height="{{ section.settings.main_image.height }}"
          loading="lazy"
        >
      {%- else -%}
        {{ 'image' | placeholder_svg_tag: 'rounded-2xl shadow-2xl w-full object-cover' }}
      {%- endif -%}

      {%- if section.settings.show_rotating_circle -%}
        <div id="floatingimg" class="absolute -top-24 -right-24 z-10">
          {%- assign circle_id = 'parallax-circle-' | append: section.id -%}
          {%- assign trigger_id = 'parallax-section-' | append: section.id -%}
          {% render 'rotating-circle-text',
            id: circle_id,
            trigger_section_id: trigger_id,
            main_text_line1: section.settings.circle_center_line1,
            main_text_line2: section.settings.circle_center_line2,
            circular_text: section.settings.circle_text,
            main_text_size: section.settings.circle_center_font_size,
            main_text_color: section.settings.circle_center_color,
            circular_text_size: section.settings.circle_text_font_size,
            circular_text_color: section.settings.circle_text_color,
            size: section.settings.circle_size
          %}
        </div>
      {%- endif -%}
    </div>

    <div class="bottomele">
      {%- if section.settings.description_text != blank -%}
        <p class="description-text mt-8 max-w-sm">
          {{ section.settings.description_text }}
        </p>
      {%- endif -%}

      <div class="mt-8 flex flex-row gap-4 justify-center flex-wrap">
        {%- if section.settings.primary_button_text != blank -%}
          <a
            href="{{ section.settings.primary_button_link }}"
            class="btn-primary px-8 py-3 font-semibold rounded-lg transition-colors inline-block"
          >
            {{ section.settings.primary_button_text }}
          </a>
        {%- endif -%}

        {%- if section.settings.secondary_button_text != blank -%}
          <a
            href="{{ section.settings.secondary_button_link }}"
            class="btn-secondary px-8 py-3 font-semibold border rounded-lg transition-colors inline-block"
          >
            {{ section.settings.secondary_button_text }}
          </a>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

<script>
  (function () {
    const sectionId = '{{ section.id }}';
    const section = document.getElementById(`parallax-section-${sectionId}`);

    function initParallaxTextAnimations() {
      if (!section) return;

      const mainimg = section.querySelector('.mainimg');
      const bottomele = section.querySelector('.bottomele');
      const textcontainer = section.querySelector('.textcontainer');
      const headingPrimary = section.querySelector('.heading-primary');
      const headingSecondary = section.querySelector('.heading-secondary');
      const floatingimg = section.querySelector('#floatingimg');

      const tl = gsap
        .timeline()
        .from(headingPrimary, { x: '-100vw', ease: 'none', duration: 1 })
        .from(headingSecondary, { x: '100vw', ease: 'none', duration: 1 }, '<')
        .from(mainimg, { y: 500 })
        .from(floatingimg, { y: 500 })
        .from(bottomele, { y: 500 });

      ScrollTrigger.create({
        animation: tl,
        trigger: section,
        scrub: 1,
        start: '-50% 50%',
        end: '70% 50%',
      });
    }

    // Run when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initParallaxTextAnimations);
    } else {
      initParallaxTextAnimations();
    }
  })();
</script>

{% schema %}
{
  "name": "Parallax Text",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading_text",
      "label": "Heading Text",
      "default": "Main Section Heading"
    },
    {
      "type": "text",
      "id": "subheading_text",
      "label": "Subheading Text",
      "default": "This is the secondary line of text providing more context."
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Main Image"
    },
    {
      "type": "textarea",
      "id": "description_text",
      "label": "Description Text",
      "default": "This is the smaller supplementary text that sits right below the main image to provide extra details or captions."
    },
    {
      "type": "header",
      "content": "Primary Button"
    },
    {
      "type": "text",
      "id": "primary_button_text",
      "label": "Primary Button Text",
      "default": "Primary Action"
    },
    {
      "type": "url",
      "id": "primary_button_link",
      "label": "Primary Button Link"
    },
    {
      "type": "header",
      "content": "Secondary Button"
    },
    {
      "type": "text",
      "id": "secondary_button_text",
      "label": "Secondary Button Text",
      "default": "Learn More"
    },
    {
      "type": "url",
      "id": "secondary_button_link",
      "label": "Secondary Button Link"
    },
    {
      "type": "header",
      "content": "Font Sizes"
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "label": "Heading Font Size",
      "min": 16,
      "max": 72,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "subheading_font_size",
      "label": "Subheading Font Size",
      "min": 14,
      "max": 60,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "description_font_size",
      "label": "Description Font Size",
      "min": 10,
      "max": 24,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "section_bg_color",
      "label": "Section Background Color",
      "default": "#f9fafb"
    },
    {
      "type": "color",
      "id": "heading_text_color",
      "label": "Heading Text Color",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "subheading_text_color",
      "label": "Subheading Text Color",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "description_text_color",
      "label": "Description Text Color",
      "default": "#6b7280"
    },
    {
      "type": "header",
      "content": "Button Colors"
    },
    {
      "type": "color",
      "id": "primary_button_bg",
      "label": "Primary Button Background",
      "default": "#4f46e5"
    },
    {
      "type": "color",
      "id": "primary_button_text_color",
      "label": "Primary Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "secondary_button_bg",
      "label": "Secondary Button Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "secondary_button_text_color",
      "label": "Secondary Button Text Color",
      "default": "#4f46e5"
    },
    {
      "type": "header",
      "content": "Rotating Circle"
    },
    {
      "type": "checkbox",
      "id": "show_rotating_circle",
      "label": "Show Rotating Circle",
      "default": true
    },
    {
      "type": "text",
      "id": "circle_center_line1",
      "label": "Center Text Line 1",
      "default": "Main"
    },
    {
      "type": "text",
      "id": "circle_center_line2",
      "label": "Center Text Line 2",
      "default": "Text"
    },
    {
      "type": "text",
      "id": "circle_text",
      "label": "Circular Text",
      "default": "Circular Text Surrounding The Main Text • Cool SVG Design •"
    },
    {
      "type": "range",
      "id": "circle_size",
      "label": "Circle Size",
      "min": 100,
      "max": 400,
      "step": 10,
      "default": 200,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "circle_center_font_size",
      "label": "Center Text Font Size",
      "min": 14,
      "max": 48,
      "step": 2,
      "default": 30,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "circle_text_font_size",
      "label": "Circular Text Font Size",
      "min": 8,
      "max": 24,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "circle_center_color",
      "label": "Center Text Color",
      "default": "#1e293b"
    },
    {
      "type": "color",
      "id": "circle_text_color",
      "label": "Circular Text Color",
      "default": "#4f46e5"
    }
  ],
  "presets": [
    {
      "name": "Parallax Text"
    }
  ]
}
{% endschema %}
