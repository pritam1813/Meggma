<section id="main-parallax" class="h-screen w-full relative overflow-hidden bg-black">
  <div id="bg-img" class="absolute top-0 left-0 w-full h-[130vh] z-0">
    <img
      src="https://images.unsplash.com/photo-1767547708642-97afe4b4e583?crop=entropy&cs=srgb&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3NjgzMDM1MzN8&ixlib=rb-4.1.0&q=85"
      alt="Background"
      class="w-full h-full object-cover opacity-80"
      width="1920"
      height="1080"
    >
  </div>

  <div class="absolute inset-0 z-10 w-full h-full pointer-events-none">
    <div class="parallax-subsection absolute inset-0 flex items-center justify-center space-x-8 px-4 w-full h-full">
      <div class="w-[25vw] h-[35vh] bg-gray-800 rounded-xl overflow-hidden shadow-2xl border border-white/10">
        <img
          src="https://images.unsplash.com/photo-1766133238998-b6813eaea76f?crop=entropy&cs=srgb&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3NjgzMDM1MzN8&ixlib=rb-4.1.0&q=85"
          class="w-full h-full object-cover"
          width="1920"
          height="1080"
        >
      </div>
      <div class="w-[25vw] h-[35vh] bg-gray-800 rounded-xl overflow-hidden shadow-2xl border border-white/10">
        <img
          src="https://images.unsplash.com/photo-1767622398131-c9c782b25d3a?crop=entropy&cs=srgb&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3NjgzMDM1MzN8&ixlib=rb-4.1.0&q=85"
          class="w-full h-full object-cover"
          width="1920"
          height="1080"
        >
      </div>
    </div>

    <div class="parallax-subsection absolute inset-0 flex items-center justify-center w-full h-full">
      <div class="bg-white text-black p-12 rounded-2xl max-w-2xl shadow-2xl text-center">
        <h2 class="text-4xl font-bold mb-4">Subsection Two</h2>
        <p class="text-lg">This slides up immediately after the first one leaves.</p>
      </div>
    </div>

    <div class="parallax-subsection absolute inset-0 flex items-center justify-center w-full h-full">
      <div class="bg-blue-600 text-white p-12 rounded-2xl max-w-2xl shadow-2xl text-center">
        <h2 class="text-4xl font-bold mb-4">Subsection Three</h2>
        <p class="text-lg">The background is still moving slowly behind us.</p>
      </div>
    </div>
  </div>
</section>

{%- comment -%} Section-specific GSAP animations {%- endcomment -%}
<script>
  (function () {
    function initHeroAnimations() {
      gsap.registerPlugin(ScrollTrigger);

      // 1. Select items
      const subsections = gsap.utils.toArray('.parallax-subsection');
      const bgImage = document.querySelector('#bg-img img');

      // 2. Initial Setup: Push all subsections down (off-screen)
      gsap.set(subsections, { yPercent: 100 });

      // 3. Create the Timeline
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: '#main-parallax',
          start: 'top top',
          end: '+=' + subsections.length * 100 + '%',
          scrub: 1,
          pin: true,
        },
      });

      // 4. THE CAROUSEL LOOP
      subsections.forEach((section, index) => {
        const startTime = index;

        // Slide IN (Enter)
        tl.to(
          section,
          {
            yPercent: 0,
            ease: 'none',
            duration: 1,
          },
          startTime
        );

        // Slide OUT (Exit) - If it's not the last one
        if (index < subsections.length - 1) {
          tl.to(
            section,
            {
              yPercent: -100,
              ease: 'none',
              duration: 1,
            },
            startTime + 1
          );
        }
      });

      // 5. THE BACKGROUND MOVEMENT (Runs parallel to everything)
      tl.to(
        bgImage,
        {
          yPercent: -15,
          ease: 'none',
          duration: subsections.length + 1,
        },
        0
      );
    }

    // Run when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initHeroAnimations);
    } else {
      initHeroAnimations();
    }
  })();
</script>

{% schema %}
{
  "name": "Hero",
  "settings": [
    {
      "id": "title",
      "type": "text",
      "label": "Title"
    }
  ],
  "presets": [
    {
      "name": "Hero",
      "category": "Content"
    }
  ]
}
{% endschema %}
